syntax = "proto3";

option go_package = "telepathy-server/proto";

import "common.proto";
import "error.proto";

service UserService {
  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse) {}
  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse) {}
  rpc GetStudents(GetStudentsRequest) returns (GetStudentsResponse) {}
  rpc GetUsersByUuids(GetUsersByUuidsRequest)
      returns (GetUsersByUuidsResponse) {}
  rpc GetRandomNick(GetRandomNickRequest) returns (GetRandomNickResponse) {}
  rpc GetUserByPhone(GetUserByPhoneRequest) returns (GetUserByPhoneResponse) {}

  // * 익명 프로필 서비스
  rpc CreateAnonymousProfile(CreateAnonymousProfileRequest)
      returns (CreateAnonymousProfileResponse) {}
  rpc CreateCrushProfile(CreateCrushProfileRequest)
      returns (CreateCrushProfileResponse) {}
  rpc GetAnonymousProfile(GetAnonymousProfileRequest)
      returns (GetAnonymousProfileResponse) {}
  rpc GetCrushProfile(GetCrushProfileRequest)
      returns (GetCrushProfileResponse) {}
  rpc GetSentHeart(GetSentHeartRequest) returns (GetSentHeartResponse) {}
  rpc GetReceivedHeart(GetReceivedHeartRequest)
      returns (GetReceivedHeartResponse) {}
  rpc DeleteProfile(DeleteProfileRequest) returns (DeleteProfileResponse) {}
  rpc SearchUsers(SearchUsersRequest) returns (SearchUsersResponse) {}
}

/*
profile을 업데이트하는 서비스 -> 기존의 정보와 바뀐 정보를 조합하고 채워넣어
보내주시면 됩니다. profile Image 삭제와 같은 경우에는 마찬가지로 다음과 같이
보내주시면 됩니다. prefix :
"https://storage.googleapis.com/telepathy-server/image/{사진_이름}" 여성 ->
"girlThumbnail.png"과 "girl.png"를 보내주시면 됩니다. 남성 ->
"boyThumbnail.png"과 "boy.png"를 보내주시면 됩니다.
*/
message UpdateUserRequest {
  optional string name = 1;
  optional string description = 2;
  optional string schoolCode = 3;

  optional string schoolName = 12; // 학교 풀네임 이동

  repeated ChipItem chips = 4;
  optional string profile_img_url = 5;
  optional string thumbnail_img_url = 6;
  optional string fcmToken = 7; // 서버에만 업데이트 함
  optional string birth = 8;
  optional EGender gender = 9;
  optional bool isInitialized = 10;
  optional Config config = 11;
}

message UpdateUserResponse {
  Status status = 1;
  optional User user = 2;
}

message DeleteUserRequest {string reason = 2;}

message DeleteUserResponse {
  // Error_INVALID_UID,Error_MONGO_DELETE, Error_MONGO_INSERT, Error_NO_ERROR
  Status status = 1;
}

message StudentsInGrade {
  int32 grade = 1;
  repeated User students = 2;
}

message GetStudentsRequest {
  optional string schoolCode = 1;
  optional string name = 2;
}

message GetStudentsResponse {
  Status status = 1;
  repeated User students = 2;
}

message GetUsersByUuidsRequest {repeated string uuids = 1;}

message GetUsersByUuidsResponse {
  Status status = 1;
  repeated User users = 2;
}

message GetRandomNickRequest {}

message GetRandomNickResponse {
  Status status = 1;
  string randomNick = 2;
}

message GetUserByPhoneRequest {
  string phone = 1; // +8210...
}

message GetUserByPhoneResponse {
  Status status = 1;
  User user = 2;
}

// * 익명 프로필 서비스
message CreateAnonymousProfileRequest {User user = 1;}
message CreateAnonymousProfileResponse {
  Status status = 1;
  User profile = 2;
}

message CreateCrushProfileRequest {
  User user = 1;
  bool is_target_exist = 2;
  optional string target_phone_number = 3;
  optional string target_name = 4;
}
message CreateCrushProfileResponse {
  Status status = 1;
  User profile = 2;
}

message GetAnonymousProfileRequest {}
message GetAnonymousProfileResponse {
  Status status = 1;
  User profile = 2;
}

message GetCrushProfileRequest {}
message GetCrushProfileResponse {
  Status status = 1;
  User profile = 2;
}

message GetSentHeartRequest {}
message GetSentHeartResponse {
  Status status = 1;
  User sentHeart = 2;
}

message GetReceivedHeartRequest {}
message GetReceivedHeartResponse {
  Status status = 1;
  repeated User receivedHeart = 2;
}

message DeleteProfileRequest {string profile_id = 1;}
message DeleteProfileResponse {Status status = 1;}


message SearchUsersRequest {
  repeated string uuids = 1;
  repeated string phone_number_hashes = 2;
}

message SearchUsersResponse {
  Status status = 1;
  repeated User users = 2;
}
