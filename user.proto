syntax = "proto3";

option go_package = "telepathy-server/proto";

import "google/protobuf/wrappers.proto";

import "common.proto";
import "error.proto";

service UserService {
  rpc GetMyProfile(GetMyProfileRequest) returns (GetMyProfileResponse) {}
  rpc UpdateProfile(UpdateProfileRequest) returns (UpdateProfileResponse) {}
  rpc SetProfile(SetProfileRequest) returns (SetProfileResponse) {}
  rpc GetMyPage(GetMyPageRequest) returns (GetMyPageResponse) {}
  rpc UpdateConfig(UpdateConfigRequest) returns (UpdateConfigResponse) {}
  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse) {}
  rpc CreateInquiry(CreateInquiryRequest) returns (CreateInquiryResponse) {}
  rpc CreateReport(CreateReportRequest) returns (CreateReportResponse) {}
  rpc GetStudents(GetStudentsRequest) returns (GetStudentsResponse) {}
  rpc GetUsersByDids(GetUsersByDidsRequest) returns (GetUsersByDidsResponse) {}
}

message Config {
  google.protobuf.BoolValue heartLock = 1;
  google.protobuf.BoolValue systemAlarm = 2;
  google.protobuf.BoolValue questionAlarm = 3;
  google.protobuf.BoolValue bluetoothAlarm = 4;
  google.protobuf.BoolValue likeAlarm = 5;
}

message GetMyProfileRequest { string uid = 1; }

message GetMyProfileResponse {
  Status status = 1;
  string uid = 2;
  string name = 3;
  Chip chip = 4;
  string description = 5;
  string birth = 6;
  bool gender = 7;
  string profileImgURL = 8;
  string thumbnailImgURL = 9;
}

/* 
profile을 업데이트하는 서비스 -> 기존의 정보와 바뀐 정보를 조합하고 채워넣어 보내주시면 됩니다.
profile Image 삭제와 같은 경우에는 마찬가지로 다음과 같이 보내주시면 됩니다.
prefix : "https://storage.googleapis.com/telepathy-server/image/{사진_이름}"
여성 -> "girlThumbnail.png"과 "girl.png"를 보내주시면 됩니다. 
남성 -> "boyThumbnail.png"과 "boy.png"를 보내주시면 됩니다.
*/
message UpdateProfileRequest {
  string uid = 1;
  string name = 2;
  string description = 3;
  string schoolCode = 4;
  Chip chip = 5;
  string profileImgURL = 6;
  string thumbnailImgURL = 7;
}

message UpdateProfileResponse {
  Status status = 1; // Error_INVALID_UID, Error_FILE_UPLOAD_ERROR,
                     // MONGO_UPDATE, Error_NO_ERROR
}

/*
profile을 설정하는 서비스(초기에 한번!)
profileImgURL과 같은 경우엔, 특별히 설정하지 않았다면
prefix : "https://storage.googleapis.com/telepathy-server/image/{사진_이름}"
여성 -> "girlThumbnail.png"과 "girl.png"를 보내주시면 됩니다. 
남성 -> "boyThumbnail.png"과 "boy.png"를 보내주시면 됩니다. 
*/
message SetProfileRequest {
  string uid = 1;
  string schoolCode = 2;
  Chip chip = 3;
  string profileImgURL = 4; 
  string thumbnailImgURL = 5;
}

message SetProfileResponse {
  Status status = 1; // Error_INVALID_UID, Error_FILE_UPLOAD_ERROR,
                     // MONGO_UPDATE, Error_NO_ERROR
}

message UpdateConfigRequest {
  reserved 1;
  string uid = 2;
  Config config = 3;
}

message UpdateConfigResponse {
  Status status = 1; // Error_INVALID_UID, MONGO_UPDATE, Error_NO_ERROR
}

message GetMyPageRequest { string uid = 1; }

message GetMyPageResponse {
  // Error_INVALID_UID, Error_USER_NOT_REGISTERED, Error_NO_ERROR
  Status status = 1;
  string name = 2;
  string description = 3;
  string birth = 4;
  Chip chip = 5;
  Config config = 6;
  int32 bestFriends = 7;
  string profileImgURL = 8;
  string thumbnailImgURL = 9;
}

message DeleteUserRequest {
  string uid = 1;
  string reason = 2;
}

message DeleteUserResponse {
  // Error_INVALID_UID,Error_MONGO_DELETE, Error_MONGO_INSERT, Error_NO_ERROR
  Status status = 1;
}

message CreateInquiryRequest {
  string uid = 1;
  string kind = 2;
  string title = 3;
  string content = 4;
  string replyEmail = 5;
  repeated bytes images = 6;
  bool agreement = 7;
}

message CreateInquiryResponse {
  // Error_KST_FAILED, Error_MONGO_INSERT, Error_NO_ERROR
  Status status = 1;
}

message CreateReportRequest {
  string uid = 1;
  string kind = 2;
  string target = 3;
  string problemType = 4;
  string problemDetail = 5;
}
message CreateReportResponse {
  // Error_KST_FAILED, Error_MONGO_INSERT, Error_NO_ERROR
  Status status = 1;
}

message Student {
  string uid = 1;
  string name = 2;
  string profileImgURL = 3;
  string thumbnailImgURL = 4;
}

message Students {
  int32 grade = 1;
  repeated Student student = 2;
}

message GetStudentsRequest {
  string uid = 1;
  string schoolCode = 2;
}

message GetStudentsResponse {
  Status status = 1;
  repeated Students students = 2;
  string schoolCode = 3;
  string shortSchoolName = 4;
}

message GetUsersByDidsRequest { repeated string dIds = 1; }

message GetUsersByDidsResponse {
  Status status = 1;
  repeated User users = 2;
}
